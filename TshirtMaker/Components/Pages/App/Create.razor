@page "/create"
@rendermode InteractiveServer
@using TshirtMaker.Components.ui.creation
@layout MainLayout
@inject NavigationManager Nav

<PageTitle>TshirtMaker - AI Creation Workspace</PageTitle>

<main class="create-main">
    <div class="create-container">
        <!-- Left Sidebar: Configuration -->
        <aside class="create-sidebar create-sidebar-left">
            <div class="create-sidebar-content">
                <div class="create-section">
                    <h3 class="create-section-title">Garment Specs</h3>
                    <div class="create-specs">
                        <!-- Apparel Type -->
                        <div class="create-spec-group">
                            <p class="create-label">Apparel Type</p>
                            <div class="create-radio-group">
                                <label class="create-radio-label @(selectedApparelType == "T-shirt" ? "active" : "")">
                                    <span>T-shirt</span>
                                    <input type="radio" name="apparel-type" value="T-shirt"
                                           checked="@(selectedApparelType == "T-shirt")"
                                           @onchange="@(() => selectedApparelType = "T-shirt")" />
                                </label>
                                <label class="create-radio-label @(selectedApparelType == "Hoodie" ? "active" : "")">
                                    <span>Hoodie</span>
                                    <input type="radio" name="apparel-type" value="Hoodie"
                                           checked="@(selectedApparelType == "Hoodie")"
                                           @onchange="@(() => selectedApparelType = "Hoodie")" />
                                </label>
                                <label class="create-radio-label @(selectedApparelType == "Sweat" ? "active" : "")">
                                    <span>Sweat</span>
                                    <input type="radio" name="apparel-type" value="Sweat"
                                           checked="@(selectedApparelType == "Sweat")"
                                           @onchange="@(() => selectedApparelType = "Sweat")" />
                                </label>
                            </div>
                        </div>

                        <!-- Base Color -->
                        <div class="create-spec-group">
                            <p class="create-label">Base Color</p>
                            <div class="create-color-picker">
                                @foreach (var color in baseColors)
                                {
                                    <button class="create-color-btn @(selectedColor == color.Value ? "active" : "")"
                                            style="background-color: @color.Value"
                                            @onclick="@(() => selectedColor = color.Value)" title="@color.Name"></button>
                                }
                            </div>
                        </div>

                        <!-- Size Selector -->
                        <div class="create-spec-group">
                            <p class="create-label">Size</p>
                            <div class="create-size-grid">
                                @foreach (var size in sizes)
                                {
                                    <button class="create-size-btn @(selectedSize == size ? "active" : "")"
                                            @onclick="@(() => selectedSize = size)">
                                        @size
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Material Specs -->
                <div class="create-section create-section-divider">
                    <h4 class="create-subsection-title">Fabric Texture</h4>
                    <div class="create-material-grid">
                        <div class="create-material-card @(selectedMaterial == "Heavy Cotton" ? "active" : "")"
                             @onclick="@(() => selectedMaterial = "Heavy Cotton")">
                            <div class="create-material-preview create-material-cotton"></div>
                            <span>Heavy Cotton</span>
                        </div>
                        <div class="create-material-card @(selectedMaterial == "Polyester" ? "active" : "")"
                             @onclick="@(() => selectedMaterial = "Polyester")">
                            <div class="create-material-preview create-material-polyester"></div>
                            <span>Polyester</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center: 3D Preview Viewport -->
        <section class="create-viewport">
            <!-- Viewport Tools -->
            @if (currentWindow == "setup")
            {
                <div class="create-viewport-tools">
                    <button class="create-tool-btn" title="View in AR">
                        <span class="material-symbols-outlined">view_in_ar</span>
                    </button>
                    <button class="create-tool-btn" title="Fullscreen">
                        <span class="material-symbols-outlined">fullscreen</span>
                    </button>
                </div>
            }


            <!-- Step Navigation Buttons -->
            <div class="create-step-nav">
                <button type="button" class="create-step-btn @(currentWindow == "setup" ? "active" : "")"
                        @onclick="SetWindowToSetup">
                    <div class="create-step-indicator"></div>
                    <span class="create-step-label">Setup</span>
                </button>
                <div class="create-step-connector"></div>
                <button type="button" class="create-step-btn @(currentWindow == "creation" ? "active" : "")"
                        @onclick="SetWindowToCreation">
                    <div class="create-step-indicator"></div>
                    <span class="create-step-label">Creation</span>
                </button>
                <div class="create-step-connector"></div>
                <button type="button" class="create-step-btn @(currentWindow == "finalization" ? "active" : "")"
                        @onclick="SetWindowToFinalization">
                    <div class="create-step-indicator"></div>
                    <span class="create-step-label">Finalization</span>
                </button>
            </div>

            <!-- Main 3D Model Placeholder -->
            <div class="create-preview-container">
                @* hon habilai *@
                @if (currentWindow == "setup")
                {
                    <div class="create-preview-wrapper">
                        <!-- Glow effect behind the shirt -->
                        <div class="create-preview-glow"></div>
                        <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuDmEMtTaAHkxTj9AB6Ss4qgOA8YWdxcJmfQ93v4sRpK3lKF4AlD2p8mYvfAc5aqxBVPbkv_2VB-CuL8JQkmcqqgULm-g4ENnm0ZDG4jNXNfUpHxeC9Oa2oLzT2t8udhTGMCqmcN5FOi-Fa6I7JGBR0Z19uxmarFqH6lZloRePqQqa-or30w29Sspg7_njVzZbZR6Nbf7FfNWDu0sQ4ArkSZHwCDMfrV2OxBhNWT7Yhva3gge5G1FmRnBpSePC5l5GU-i-sRWbT3JomV"
                             alt="Interactive 3D preview" class="create-preview-image" />

                        <!-- Floating rotation controls -->
                        <div class="create-rotation-controls">
                            <button class="create-rotation-btn" @onclick="RotateLeft">
                                <span class="material-symbols-outlined">rotate_left</span>
                            </button>
                            <div class="create-rotation-divider"></div>
                            <span class="create-rotation-label">FRONT VIEW</span>
                            <div class="create-rotation-divider"></div>
                            <button class="create-rotation-btn" @onclick="RotateRight">
                                <span class="material-symbols-outlined">rotate_right</span>
                            </button>
                        </div>
                    </div>

                }
                @if (currentWindow == "creation")
                {
                    <Creation />

                }
                @if (currentWindow == "finalization")
                {
                    <Finalization />
                }
            </div>

            <!-- Bottom Action Bar -->
            <div class="create-action-bar">
                <button class="create-generate-btn" @onclick="GenerateAIArt">
                    <span class="material-symbols-outlined">auto_awesome</span>
                    GENERATE AI ART
                </button>
            </div>
        </section>

        <!-- Right Sidebar: Creative Engine -->
        <aside class="create-sidebar create-sidebar-right">
            <div class="create-sidebar-content">
                <div class="create-section">
                    <h3 class="create-section-title">Design Engine</h3>
                    <p class="create-section-subtitle">AI-powered artwork generation for your apparel.</p>

                    <div class="create-design-content">
                        <!-- Style Presets -->
                        <div class="create-preset-group">
                            <p class="create-label">Preset Styles</p>
                            <div class="create-preset-grid">
                                @foreach (var preset in stylePresets)
                                {
                                    <div class="create-preset-card @(selectedPreset == preset.Name ? "active" : "")"
                                         @onclick="@(() => selectedPreset = preset.Name)">
                                        <div class="create-preset-overlay"></div>
                                        <img src="@preset.ImageUrl" alt="@preset.Name" />
                                        <div class="create-preset-label">
                                            <p>@preset.Name</p>
                                        </div>
                                        @if (selectedPreset == preset.Name)
                                        {
                                            <div class="create-preset-check">
                                                <span class="material-symbols-outlined">check</span>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Prompt Input -->
                        <div class="create-prompt-group">
                            <div class="create-prompt-header">
                                <p class="create-label">Prompt Input</p>
                                <button class="create-enhance-btn" @onclick="EnhancePrompt">
                                    <span class="material-symbols-outlined">bolt</span>
                                    ENHANCE
                                </button>
                            </div>
                            <div class="create-textarea-wrapper">
                                <textarea class="create-textarea"
                                          placeholder="Describe the artwork you want to generate on the center of the garment..."
                                          @bind="promptText" @bind:event="oninput" maxlength="500"></textarea>
                                <div class="create-char-count">@promptText.Length / 500</div>
                            </div>
                        </div>

                        <!-- Negative Prompt (Advanced) -->
                        <div class="create-advanced-group">
                            <details class="create-advanced-details">
                                <summary class="create-advanced-summary">
                                    <span>Advanced Settings</span>
                                    <span class="material-symbols-outlined">expand_more</span>
                                </summary>
                                <div class="create-advanced-content">
                                    <div class="create-advanced-field">
                                        <p class="create-advanced-label">Negative Prompt</p>
                                        <input class="create-advanced-input" type="text"
                                               placeholder="What to exclude (e.g. text, blur)" @bind="negativePrompt" />
                                    </div>
                                    <div class="create-advanced-field">
                                        <p class="create-advanced-label">Upscale Resolution</p>
                                        <div class="create-resolution-buttons">
                                            <button class="create-resolution-btn @(selectedResolution == "2K" ? "active" : "")"
                                                    @onclick="@(() => selectedResolution = "2K")">
                                                2K
                                            </button>
                                            <button class="create-resolution-btn @(selectedResolution == "4K" ? "active" : "")"
                                                    @onclick="@(() => selectedResolution = "4K")">
                                                4K
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</main>

@code {
    private string currentWindow = "setup";
    private string selectedApparelType = "T-shirt";
    private string selectedColor = "#FFFFFF";
    private string selectedSize = "M";
    private string selectedMaterial = "Heavy Cotton";
    private string selectedPreset = "Cyberpunk";
    private string promptText = string.Empty;
    private string negativePrompt = string.Empty;
    private string selectedResolution = "2K";
    private int rotationAngle = 0;
    private List<(string Name, string Value)> baseColors = new()
{
("White", "#FFFFFF"),
("Black", "#000000"),
("Blue", "#2563eb"),
("Red", "#dc2626"),
("Green", "#16a34a"),
("Gray", "#6b7280")
};

    private List<string> sizes = new() { "S", "M", "L", "XL", "2XL" };

    private List<(string Name, string ImageUrl)> stylePresets = new()
{
("Cyberpunk",
"https://lh3.googleusercontent.com/aida-public/AB6AXuBt2m-dKuGB-CEJj4W_lHKWekTbX9OOmwOC0f_0p28i41m0HjEQ4phkFzQBp8VYSMc8v4-IiSOh1ZxVQmOl3_gRvVigwqbraeMe-4-qOTYlMjrNuYvUTax6R6-hz4rWcLtWPsjuv7_eEUkIT7Z0WpIH73Xmyn5-WH5f-JtjFpPHwbj6HXlueDf_CzocZnQ4yrl2xV363qsX4Jyaw2TaB12p2dqNmMvhDdy_9Q4XBIukZcR-WS6ygHQgzUd5eTqXue_mTsQzi_aiemg1"),
("Anime",
"https://lh3.googleusercontent.com/aida-public/AB6AXuBgl2jxxhI84gRWsIEF6rbRSo-fRow5hIs77L-Vs5mG7NTUcbxqlbR1fKrTmcZyzIPW1p8O_xDQ5xrtpQr77qacRcsDF0P4vege7ldXkAkfTT_AMBHc6dymiYQpEsS2z9hr5NiFrGgQcDBM7FXIk-RkLw_oQ7mLcSS5joJ9-pEC8kU-Ki2Pio-teAjY6cJdXoiqZHKxaz2-vFN2kVwzuYbzJm22EirlBcLmAoHhyqdl2fDPeXplWM8N4Rw9xio1SOV0bo0yFyX-Bwx_"),
("Minimalism",
"https://lh3.googleusercontent.com/aida-public/AB6AXuCK3cVoEYBECT9OxiQaMjP-45ftq1x6dQOdwIYdhdccxECTIffUwfqHmqISBQEGF0DQO2SS12S-2lqUKVV-JIOEBOUY105YTyMz8TbndASp1npKFKmdh8QQ9KmmhngAt0rH-HjUl0Qe5YrmGPmgZ1705JR_A977OoBQzdobEVgfQCPH00GPv6W4yclQTGQsEj5TBwaJrlvXaFyx7SXNMijP62IYvZkHUhqlwRnJr_g2RVGbD01ykaFt6e9hP9ie_tGUCa7loOdVBbFl"),
("Oil Paint",
"https://lh3.googleusercontent.com/aida-public/AB6AXuDFKat-1ZrTQ1GdsYrQZ1qLU_SaT3XCg0Psg4oqPG6yh4rmxDpIf4KXHAYBAB_ZXEzR16JqV9pYtKoQMVaOygHDBVp1xCSRqntmjAVYAqjyhcp668d-DO1VY4XkR-4sJZwk1YBejJfKNkt9LegDPTXlS5r9-1tBHbx2J2FvnKNhq0XYnK574c2VRXhVpM9orIgY9HxO6LJACrOHbQcovtAn5KYBDLD7jZWF_Xqy37o_5wvjFEqia_Tu-VGS5aNk9t2ETOaeb0NgGcd9")
};

    private void RotateLeft()
    {
        rotationAngle -= 90;
        StateHasChanged();
    }

    private void RotateRight()
    {
        rotationAngle += 90;
        StateHasChanged();
    }

    private void GenerateAIArt()
    {
        // TODO: Implement AI art generation
    }

    private void EnhancePrompt()
    {
        // TODO: Implement prompt enhancement
    }

    private string ChangeWindow(string window)
    {
        currentWindow = window;
        StateHasChanged();
        return currentWindow;
    }

    private void SetWindowToSetup() => ChangeWindow("setup");
    private void SetWindowToCreation() => ChangeWindow("creation");
    private void SetWindowToFinalization() => ChangeWindow("finalization");
}
