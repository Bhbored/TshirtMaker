@page "/signup"
@layout EmptyLayout
@using TshirtMaker.Services
@inject NavigationManager Navigation
@inject AuthService Auth

<div class="card card-custom p-4 shadow-lg fade-in" style="max-width: 450px; width: 100%;">
    <div class="text-center mb-4">
        <h2 class="fw-bold mb-2" style="background: linear-gradient(135deg, var(--custom-primary-core), var(--custom-accent-core)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            Create Account
        </h2>
        <p class="text-muted">Join us and start creating unique designs</p>
    </div>

    <EditForm Model="NewUser" OnValidSubmit="HandleSignUp" FormName="signupForm">
        <DataAnnotationsValidator />
        <div class="mb-3">
            <label class="form-label fw-semibold">Username</label>
            <InputText @bind-Value="NewUser.Username" class="form-control input-custom py-2" placeholder="Choose a username" />
            <ValidationMessage For="@(() => NewUser.Username)" />
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Email</label>
            <InputText @bind-Value="NewUser.Email" class="form-control input-custom py-2" placeholder="your@email.com" />
            <ValidationMessage For="@(() => NewUser.Email)" />
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Password</label>
            <InputText type="password" @bind-Value="NewUser.Password" class="form-control input-custom py-2" placeholder="••••••••" />
            <ValidationMessage For="@(() => NewUser.Password)" />
        </div>

        @if (!string.IsNullOrEmpty(error))
        {
            <div class="alert alert-danger">@error</div>
        }

        <button type="submit" class="btn btn-custom-primary w-100 py-2 mb-3 fw-semibold">
            Create Account
        </button>
    </EditForm>

    <div class="text-center">
        <p class="text-muted mb-0">Already have an account? <a href="/login" class="text-decoration-none" style="color: var(--custom-primary-core); font-weight: 600;">Sign In</a></p>
    </div>
</div>

@code {
    public User NewUser { get; set; } = new User();
    string error = "";

    async Task HandleSignUp()
    {
        error = "";
        var user = await Auth.SignUp(NewUser.Email, NewUser.Username, NewUser.Password);

        if (user is null)
        {
            error = "Email already exists";
            return;
        }

        Navigation.NavigateTo("/dashboard");
    }
}
