@page "/login"
@layout EmptyLayout
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Web
@using TshirtMaker.Services
@using TshirtMaker.Models
@inject NavigationManager Navigation
@inject AuthService Auth

<div class="card card-custom p-4 shadow-lg fade-in" style="max-width: 450px; width: 100%;">
    <div class="text-center mb-4">
        <h2 class="fw-bold mb-2">
            Welcome Back
        </h2>
        <p class="text-muted">Sign in to continue creating amazing designs</p>

    </div>

    @if (!string.IsNullOrEmpty(error))
    {
        <div class="alert alert-danger mb-3">@error</div>
    }



    <EditForm Model="LoginModel" OnValidSubmit="HandleLogin" FormName="loginForm">
        <DataAnnotationsValidator />
        <div class="mb-3">
            <label class="form-label fw-semibold">Email</label>
            <InputText @bind-Value="LoginModel.Email" class="form-control input-custom py-2" placeholder="your@email.com" />
            <ValidationMessage For="@(() => LoginModel.Email)" />
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Password</label>
            <InputText type="password" @bind-Value="LoginModel.Password" class="form-control input-custom py-2" placeholder="••••••••" />
            <ValidationMessage For="@(() => LoginModel.Password)" />
        </div>

        <button type="submit" class="btn btn-custom-primary w-100 py-2 mb-3 fw-semibold">Sign In</button>
    </EditForm>

    <div class="text-center">
        <p class="text-muted mb-0">Don't have an account? <a href="/signup" class="text-decoration-none" style="color: var(--custom-primary-core); font-weight: 600;">Sign Up</a></p>
    </div>


</div>

@code {
    public LoginModel LoginModel { get; set; } = new LoginModel();
    string error = "";

   
    async Task HandleLogin()
    {
        error = "";

        if (string.IsNullOrWhiteSpace(LoginModel.Email) || string.IsNullOrWhiteSpace(LoginModel.Password))
        {
            error = "Please fill in both email and password fields.";
            return;
        }

        try
        {
            var user = await Auth.Login(LoginModel.Email, LoginModel.Password);
            if (user is not null)
            {
                Navigation.NavigateTo("/dashboard");
            }
            else
            {
                error = "Invalid email or password.";
            }
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }

        
    }
}